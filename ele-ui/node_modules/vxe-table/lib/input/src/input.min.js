"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function getNumberDecimal(e){return((""+e).split(".")[1]||"").length}function addition(e,t){var a=Math.pow(10,Math.max(getNumberDecimal(e),getNumberDecimal(t)));return(e*a+t*a)/a}function subtraction(e,t){var a=getNumberDecimal(e),n=getNumberDecimal(t),i=Math.pow(10,Math.max(a,n));return parseFloat(((e*i-t*i)/i).toFixed(n<=a?a:n))}function renderDefaultInput(e,t){var a=t.inpAttrs,n=t.inpEvents;return e("input",{ref:"input",class:"vxe-input--inner",domProps:{value:t.value},attrs:a,on:n})}function renderDateInput(e,t){var a=t.inpAttrs,n=t.inpEvents;return e("input",{ref:"input",class:"vxe-input--inner",domProps:{value:t.inputValue},attrs:a,on:n})}function isDateDisabled(e,t){var a=e.dateOpts.disabledMethod;return a&&a({date:t.date,$input:e})}function renderDateDayTable(t,a){var e=a.datePanelType,n=a.dateValue,i=a.datePanelValue,s=a.dateHeaders,l=a.dayDatas,r="yyyy-MM-dd";return[t("table",{class:"vxe-input--date-".concat(e,"-view"),attrs:{cellspacing:0,cellpadding:0,border:0}},[t("thead",[t("tr",s.map(function(e){return t("th",e.label)}))]),t("tbody",l.map(function(e){return t("tr",e.map(function(e){return t("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--today":e.isToday,"is--next":e.isNext,"is--disabled":isDateDisabled(a,e),"is--selected":_xeUtils.default.isDateSame(n,e.date,r),"is--hover":_xeUtils.default.isDateSame(i,e.date,r)},on:{click:function(){return a.dateSelectEvent(e)},mouseenter:function(){return a.dateMouseenterEvent(e)}}},e.label)}))}))])]}function renderDateWeekTable(n,i){var e=i.datePanelType,s=i.dateValue,l=i.datePanelValue,t=i.weekHeaders,a=i.weekDates,r="yyyy-MM-dd";return[n("table",{class:"vxe-input--date-".concat(e,"-view"),attrs:{cellspacing:0,cellpadding:0,border:0}},[n("thead",[n("tr",t.map(function(e){return n("th",e.label)}))]),n("tbody",a.map(function(e){var t=e.some(function(e){return _xeUtils.default.isDateSame(s,e.date,r)}),a=e.some(function(e){return _xeUtils.default.isDateSame(l,e.date,r)});return n("tr",e.map(function(e){return n("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--today":e.isToday,"is--next":e.isNext,"is--disabled":isDateDisabled(i,e),"is--selected":t,"is--hover":a},on:{click:function(){return i.dateSelectEvent(e)},mouseenter:function(){return i.dateMouseenterEvent(e)}}},e.label)}))}))])]}function renderDateMonthTable(t,a){var n=a.dateValue,e=a.datePanelType,i=a.monthDatas,s=a.datePanelValue,l="yyyy-MM";return[t("table",{class:"vxe-input--date-".concat(e,"-view"),attrs:{cellspacing:0,cellpadding:0,border:0}},[t("tbody",i.map(function(e){return t("tr",e.map(function(e){return t("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--next":e.isNext,"is--disabled":isDateDisabled(a,e),"is--selected":_xeUtils.default.isDateSame(n,e.date,l),"is--hover":_xeUtils.default.isDateSame(s,e.date,l)},on:{click:function(){return a.dateSelectEvent(e)},mouseenter:function(){return a.dateMouseenterEvent(e)}}},_conf.default.i18n("vxe.input.date.months.m".concat(e.month)))}))}))])]}function renderDateYearTable(t,a){var n=a.dateValue,e=a.datePanelType,i=a.yearDatas,s=a.datePanelValue;return[t("table",{class:"vxe-input--date-".concat(e,"-view"),attrs:{cellspacing:0,cellpadding:0,border:0}},[t("tbody",i.map(function(e){return t("tr",e.map(function(e){return t("td",{class:{"is--disabled":isDateDisabled(a,e),"is--selected":_xeUtils.default.isDateSame(n,e.date,"yyyy"),"is--hover":_xeUtils.default.isDateSame(s,e.date,"yyyy")},on:{click:function(){return a.dateSelectEvent(e)},mouseenter:function(){return a.dateMouseenterEvent(e)}}},e.year)}))}))])]}function renderDateTable(e,t){switch(t.datePanelType){case"week":return renderDateWeekTable(e,t);case"month":return renderDateMonthTable(e,t);case"year":return renderDateYearTable(e,t)}return renderDateDayTable(e,t)}function rendeDatePanel(e,t){var a=t.datePanelType,n=t.selectDatePanelLabel;return[e("div",{class:"vxe-input--date-picker-header"},[e("div",{class:"vxe-input--date-picker-type-wrapper"},[e("span","year"===a?{class:"vxe-input--date-picker-label"}:{class:"vxe-input--date-picker-btn",on:{click:t.dateToggleTypeEvent}},n)]),e("div",{class:"vxe-input--date-picker-btn-wrapper"},[e("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-prev-btn",attrs:{title:_conf.default.i18n("vxe.input.date.prevMonth")},on:{click:t.datePrevEvent}},[e("i",{class:"vxe-icon--caret-left"})]),e("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-current-btn",attrs:{title:_conf.default.i18n("vxe.input.date.today")},on:{click:t.dateTodayMonthEvent}},[e("i",{class:"vxe-icon--dot"})]),e("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-next-btn",attrs:{title:_conf.default.i18n("vxe.input.date.nextMonth")},on:{click:t.dateNextEvent}},[e("i",{class:"vxe-icon--caret-right"})])])]),e("div",{class:"vxe-input--date-picker-body"},renderDateTable(e,t))]}function renderPanel(e,t){var a,n=t.type,i=t.vSize,s=t.isDatePicker,l=t.transfer,r=t.animatVisible,u=t.visiblePanel,o=t.panelPlacement,d=t.panelStyle;return s?e("div",{ref:"panel",class:["vxe-dropdown--panel vxe-input--panel","type--".concat(n),(_defineProperty(a={},"size--".concat(i),i),_defineProperty(a,"is--transfer",l),_defineProperty(a,"animat--leave",r),_defineProperty(a,"animat--enter",u),a)],attrs:{"data-placement":o},style:d},[e("div",{class:"vxe-input--panel-wrapper"},rendeDatePanel(e,t))]):null}function renderNumberIcon(e,t){return e("span",{class:"vxe-input--number"},[e("span",{class:"vxe-input--number-prev is--prev",on:{mousedown:t.numberMousedownEvent,mouseup:t.numberDropDown,mouseleave:t.numberDropDown}},[e("i",{class:["vxe-input--number-prev-icon",_conf.default.icon.inputPrevNum]})]),e("span",{class:"vxe-input--number-next is--next",on:{mousedown:t.numberMousedownEvent,mouseup:t.numberDropDown,mouseleave:t.numberDropDown}},[e("i",{class:["vxe-input--number-next-icon",_conf.default.icon.inputNextNum]})])])}function renderDatePickerIcon(e,t){return e("span",{class:"vxe-input--date-picker",on:{click:t.datePickerOpenEvent}},[e("i",{class:["vxe-input--date-picker-icon",_conf.default.icon.inputDate]})])}function renderPasswordIcon(e,t){var a=t.showPwd;return e("span",{class:"vxe-input--password",on:{click:t.passwordToggleEvent}},[e("i",{class:["vxe-input--pwd-icon",a?_conf.default.icon.inputShowPwd:_conf.default.icon.inputPwd]})])}function rendePrefixIcon(e,t){var a=t.prefixIcon;return a?e("span",{class:"vxe-input--prefix",on:{click:t.clickPrefixEvent}},[e("i",{class:["vxe-input--prefix-icon",a]})]):null}function renderSuffixIcon(e,t){var a=t.value,n=t.isClearable,i=t.disabled,s=t.suffixIcon;return n||s?e("span",{class:["vxe-input--suffix",{"is--clear":n&&!i&&!(""===a||_xeUtils.default.eqNull(a))}],on:{click:t.clickSuffixEvent}},[s?e("i",{class:["vxe-input--suffix-icon",s]}):null,n?e("i",{class:["vxe-input--clear-icon",_conf.default.icon.inputClear]}):null]):null}function renderExtraSuffixIcon(e,t){var a=t.isPassword,n=t.isNumber,i=t.isDatePicker;return a||n||i?e("span",{class:"vxe-input--extra-suffix"},[a?renderPasswordIcon(e,t):null,n?renderNumberIcon(e,t):null,i?renderDatePickerIcon(e,t):null]):null}var _default2={name:"VxeInput",props:{value:[String,Number,Date],name:String,type:{type:String,default:"text"},clearable:{type:Boolean,default:function(){return _conf.default.input.clearable}},readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],autocomplete:{type:String,default:"off"},form:String,editable:Boolean,dateConfig:Object,size:String,min:{type:[String,Number],default:null},max:{type:[String,Number],default:null},step:[String,Number],prefixIcon:String,suffixIcon:String,placement:String,transfer:{type:Boolean,default:function(){return _conf.default.input.transfer}}},data:function(){return{panelIndex:0,showPwd:!1,visiblePanel:!1,animatVisible:!1,panelStyle:null,panelPlacement:null,isActivated:!1,inputValue:"",datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},isNumber:function(){return-1<["number","integer"].indexOf(this.type)},isDatePicker:function(){return-1<["date","week","month","year"].indexOf(this.type)},isPassword:function(){return"password"===this.type},stepValue:function(){return("integer"===this.type?_xeUtils.default.toInteger(this.step):_xeUtils.default.toNumber(this.step))||1},isClearable:function(){return this.clearable&&(this.isPassword||this.isNumber||this.isDatePicker||"text"===this.type||"search"===this.type)},dateValue:function(){var e=this.value;return e?_xeUtils.default.toStringDate(e,this.dateValueFormat):null},dateLabelFormat:function(){return this.isDatePicker?this.dateOpts.labelFormat||_conf.default.i18n("vxe.input.date.labelFormat.".concat(this.type)):null},dateValueFormat:function(){return this.dateOpts.valueFormat||"yyyy-MM-dd"},selectDatePanelLabel:function(){var e,t=this.datePanelType,a=this.selectMonth,n=this.yearList,i="";return a&&(i=a.getFullYear(),e=a.getMonth()+1),"month"===t?_xeUtils.default.template(_conf.default.i18n("vxe.input.date.monthLabel"),[i]):"year"===t?n.length?"".concat(n[0].year," - ").concat(n[n.length-1].year):"":_xeUtils.default.template(_conf.default.i18n("vxe.input.date.dayLabel"),[i,e?_conf.default.i18n("vxe.input.date.m".concat(e)):"-"])},weekDatas:function(){for(var e=_xeUtils.default.toNumber(this.dateOpts.startWeek),t=[e],a=0;a<6;a++)6<=e?e=0:e++,t.push(e);return t},dateHeaders:function(){return this.weekDatas.map(function(e){return{value:e,label:_conf.default.i18n("vxe.input.date.weeks.w".concat(e))}})},weekHeaders:function(){return[{label:_conf.default.i18n("vxe.input.date.weeks.w")}].concat(this.dateHeaders)},yearList:function(){var e=this.selectMonth,t=[];if(e)for(var a=0;a<16;a++){var n=_xeUtils.default.getWhatYear(e,a,"first");t.push({date:n,year:n.getFullYear()})}return t},yearDatas:function(){return _xeUtils.default.chunk(this.yearList,4)},monthList:function(){var e=this.selectMonth,t=[];if(e)for(var a=_xeUtils.default.getWhatYear(e,0,"first").getFullYear(),n=0;n<16;n++){var i=_xeUtils.default.getWhatYear(e,0,n),s=i.getMonth(),l=i.getFullYear(),r=l<a;t.push({date:i,isPrev:r,isCurrent:l===a,isNext:!r&&a<l,month:s})}return t},monthDatas:function(){return _xeUtils.default.chunk(this.monthList,4)},dayList:function(){var e=this.weekDatas,t=this.selectMonth,a=this.currentDate,n=[];if(t&&a)for(var i=t.getMonth(),s=t.getDay(),l=-e.indexOf(s),r=_xeUtils.default.getWhatDay(t,l),u=0;u<42;u++){var o=_xeUtils.default.getWhatDay(r,u),d=o<t;n.push({date:o,isPrev:d,isCurrent:o.getFullYear()===t.getFullYear()&&o.getMonth()===t.getMonth(),isToday:o.getFullYear()===a.getFullYear()&&o.getMonth()===a.getMonth()&&o.getDate()===a.getDate(),isNext:!d&&i!==o.getMonth(),label:o.getDate()})}return n},dayDatas:function(){return _xeUtils.default.chunk(this.dayList,7)},weekDates:function(){return this.dayDatas.map(function(e){var t=e[0];return[{date:t.date,isPrev:!1,isCurrent:!1,isToday:!1,isNext:!1,label:_xeUtils.default.getYearWeek(t.date)}].concat(e)})},dateOpts:function(){return Object.assign({},this.dateConfig,_conf.default.input.dateConfig)},inpAttrs:function(){var e=this.isDatePicker,t=this.isPassword,a=this.type,n=this.name,i=this.placeholder,s=this.readonly,l=this.disabled,r=this.maxlength,u=this.form,o=this.autocomplete,d=this.showPwd,h=this.dateOpts,c={name:n,form:u,type:e||t&&d?"text":a,placeholder:i,maxlength:r,readonly:s||"week"===a||!1===h.editable,disabled:l,autocomplete:o};return i&&(c.placeholder=_tools.UtilTools.getFuncText(i)),c},inpEvents:function(){var a=this,n={};return _xeUtils.default.each(this.$listeners,function(e,t){-1===["change","clear","prefix-click","suffix-click"].indexOf(t)&&(n[t]=a.triggerEvent)}),this.isNumber?n.keydown=this.keydownEvent:this.isDatePicker&&(n.click=this.clickEvent),n.input=this.inputEvent,n.focus=this.focusEvent,n}},watch:{value:function(){this.changeValue()},dateLabelFormat:function(){this.dateParseValue(this.datePanelValue),this.inputValue=this.datePanelLabel}},created:function(){this.changeValue(),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent)},mounted:function(){this.isDatePicker&&this.transfer&&document.body.appendChild(this.$refs.panel)},beforeDestroy:function(){var e=this.$refs.panel;e&&e.parentNode&&e.parentNode.removeChild(e)},destroyed:function(){this.numberDropDown(),_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"blur")},render:function(e){var t,a=this.isClearable,n=this.isDatePicker,i=this.visiblePanel,s=this.isActivated,l=this.vSize,r=this.type,u=this.readonly,o=this.disabled,d=this.prefixIcon,h=this.suffixIcon;return e("div",{class:["vxe-input","type--".concat(r),(_defineProperty(t={},"size--".concat(l),l),_defineProperty(t,"is--prefix",d),_defineProperty(t,"is--suffix",a||h),_defineProperty(t,"is--readonly",u),_defineProperty(t,"is--visivle",i),_defineProperty(t,"is--disabled",o),_defineProperty(t,"is--active",s),t)]},[rendePrefixIcon(e,this),n?renderDateInput(e,this):renderDefaultInput(e,this),renderSuffixIcon(e,this),renderExtraSuffixIcon(e,this),renderPanel(e,this)])},methods:{focus:function(){return this.$refs.input.focus(),this.$nextTick()},blur:function(){return this.$refs.input.blur(),this.$nextTick()},triggerEvent:function(e){var t=this.$refs,a=this.value;this.$emit(e.type,{$panel:t.panel,value:a},e)},emitUpdate:function(e){this.$emit("input",e),this.value!==e&&this.$emit("change",{value:e})},inputEvent:function(e){var t=this.isDatePicker,a=e.target.value;this.inputValue=a,t||this.emitUpdate(a)},focusEvent:function(e){this.isActivated=!0,this.triggerEvent(e)},keydownEvent:function(e){var t=e.keyCode,a=38===t;!a&&40!==t||(a?this.numberPrevEvent(e):this.numberNextEvent(e)),this.triggerEvent(e)},clickEvent:function(e){this.isDatePicker&&this.datePickerOpenEvent(e),this.triggerEvent(e)},clickPrefixEvent:function(e){var t=this.$refs,a=this.disabled,n=this.value;a||this.$emit("prefix-click",{$panel:t.panel,value:n},e)},clickSuffixEvent:function(e){var t=this.$refs,a=this.disabled,n=this.value;a||(_tools.DomTools.hasClass(e.currentTarget,"is--clear")?(this.emitUpdate(""),this.clearValueEvent(e,"")):this.$emit("suffix-click",{$panel:t.panel,value:n},e))},clearValueEvent:function(e,t){var a=this.$refs;this.isDatePicker&&this.hidePanel(),this.$emit("clear",{$panel:a.panel,value:t},e)},changeValue:function(){this.isDatePicker&&(this.dateParseValue(this.value),this.inputValue=this.datePanelLabel)},afterCheckValue:function(){var e=this.inpAttrs,t=this.value,a=this.isDatePicker,n=this.isNumber,i=this.dateLabelFormat,s=this.min,l=this.max;if(!e.readonly)if(n){if(t||_xeUtils.default.isNumber(t)){var r="integer"===this.type?_xeUtils.default.toInteger(t):_xeUtils.default.toNumber(t);this.vaildMinNum(r)?this.vaildMaxNum(r)?this.emitUpdate(r):this.emitUpdate(l):this.emitUpdate(s)}}else if(a){var u=this.inputValue;u&&(u=_xeUtils.default.toStringDate(u,i),_xeUtils.default.isDate(u)?_xeUtils.default.isEqual(t,u)||this.dateChangeValue(u):this.dateRevertValue())}},passwordToggleEvent:function(){var e=this.disabled,t=this.readonly,a=this.showPwd;e||t||(this.showPwd=!a)},vaildMinNum:function(e){return null===this.min||e>=_xeUtils.default.toNumber(this.min)},vaildMaxNum:function(e){return null===this.max||e<=_xeUtils.default.toNumber(this.max)},numberDropDown:function(){clearTimeout(this.downbumTimeout)},numberDownPrevEvent:function(e){var t=this;this.downbumTimeout=setTimeout(function(){t.numberPrevEvent(e),t.numberDownPrevEvent(e)},60)},numberDownNextEvent:function(e){var t=this;this.downbumTimeout=setTimeout(function(){t.numberNextEvent(e),t.numberDownNextEvent(e)},60)},numberMousedownEvent:function(e){var t=this;if(this.numberDropDown(),0===e.button){var a=_tools.DomTools.hasClass(e.currentTarget,"is--prev");a?this.numberPrevEvent(e):this.numberNextEvent(e),this.downbumTimeout=setTimeout(function(){a?t.numberDownPrevEvent(e):t.numberDownNextEvent(e)},500)}},numberPrevEvent:function(){var e=this.disabled,t=this.readonly;clearTimeout(this.downbumTimeout),e||t||this.numberChange(!0)},numberNextEvent:function(){var e=this.disabled,t=this.readonly;clearTimeout(this.downbumTimeout),e||t||this.numberChange(!1)},numberChange:function(e){var t=this.value,a=this.stepValue,n="integer"===this.type?_xeUtils.default.toInteger(t):_xeUtils.default.toNumber(t),i=e?addition(n,a):subtraction(n,a);this.vaildMinNum(i)&&this.vaildMaxNum(i)&&this.emitUpdate(i)},datePickerOpenEvent:function(e){e.preventDefault(),this.showPanel()},dateMonthHandle:function(e,t){this.selectMonth=_xeUtils.default.getWhatMonth(e,t,"first")},dateNowHandle:function(){var e=_xeUtils.default.getWhatDay(Date.now(),0,"first");this.currentDate=e,this.dateMonthHandle(e,0)},dateToggleTypeEvent:function(){var e=this.datePanelType;e="month"===e?"year":"month",this.datePanelType=e},datePrevEvent:function(){var e=this.type,t=this.datePanelType;this.selectMonth="year"===e?_xeUtils.default.getWhatYear(this.selectMonth,-16,"first"):"month"===e?"year"===t?_xeUtils.default.getWhatYear(this.selectMonth,-16,"first"):_xeUtils.default.getWhatYear(this.selectMonth,-1,"first"):"year"===t?_xeUtils.default.getWhatYear(this.selectMonth,-16,"first"):"month"===t?_xeUtils.default.getWhatYear(this.selectMonth,-1,"first"):_xeUtils.default.getWhatMonth(this.selectMonth,-1,"first")},dateTodayMonthEvent:function(){this.dateNowHandle(),this.dateChangeValue(this.currentDate),this.hidePanel()},dateNextEvent:function(){var e=this.type,t=this.datePanelType;this.selectMonth="year"===e?_xeUtils.default.getWhatYear(this.selectMonth,16,"first"):"month"===e?"year"===t?_xeUtils.default.getWhatYear(this.selectMonth,16,"first"):_xeUtils.default.getWhatYear(this.selectMonth,1,"first"):"year"===t?_xeUtils.default.getWhatYear(this.selectMonth,16,"first"):"month"===t?_xeUtils.default.getWhatYear(this.selectMonth,1,"first"):_xeUtils.default.getWhatMonth(this.selectMonth,1,"first")},dateSelectEvent:function(e){isDateDisabled(this,e)||this.dateSelectItem(e.date)},dateSelectItem:function(e){var t=this.type,a=this.datePanelType;"month"===t?"year"===a?(this.datePanelType="month",this.dateCheckMonth(e)):(this.dateChangeValue(e),this.hidePanel()):"year"===t?(this.hidePanel(),this.dateChangeValue(e)):"month"===a?(this.datePanelType="week"===t?t:"day",this.dateCheckMonth(e)):"year"===a?(this.datePanelType="month",this.dateCheckMonth(e)):(this.dateChangeValue(e),this.hidePanel())},dateMouseenterEvent:function(e){if(!isDateDisabled(this,e)){var t=this.datePanelType;"month"===t?this.dateMoveMonth(e.date):"year"===t?this.dateMoveYear(e.date):this.dateMoveDay(e.date)}},dateMoveDay:function(t){isDateDisabled(this,{date:t})||(this.dayList.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy-MM-dd")})||this.dateCheckMonth(t),this.dateParseValue(t))},dateMoveMonth:function(t){isDateDisabled(this,{date:t})||(this.monthList.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy-MM")})||this.dateCheckMonth(t),this.dateParseValue(t))},dateMoveYear:function(t){isDateDisabled(this,{date:t})||(this.yearList.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy")})||this.dateCheckMonth(t),this.dateParseValue(t))},dateParseValue:function(e){var t=this.dateLabelFormat,a=this.dateOpts,n=e?_xeUtils.default.toStringDate(e,a.parseFormat):null,i="";_xeUtils.default.isDate(n)?i=_xeUtils.default.toDateString(n,t):n=null,this.datePanelValue=n,this.datePanelLabel=i},dateOffsetEvent:function(e){var t=this.isActivated,a=this.datePanelValue,n=this.datePanelType,i=e.keyCode,s=37===i,l=38===i,r=39===i,u=40===i;if(t)if(e.preventDefault(),"month"===n){var o=_xeUtils.default.getWhatMonth(a||Date.now(),0,"first");s?o=_xeUtils.default.getWhatMonth(o,-1):l?o=_xeUtils.default.getWhatMonth(o,-4):r?o=_xeUtils.default.getWhatMonth(o,1):u&&(o=_xeUtils.default.getWhatMonth(o,4)),this.dateMoveMonth(o)}else if("year"===n){var d=_xeUtils.default.getWhatYear(a||Date.now(),0,"first");s?d=_xeUtils.default.getWhatYear(d,-1):l?d=_xeUtils.default.getWhatYear(d,-4):r?d=_xeUtils.default.getWhatYear(d,1):u&&(d=_xeUtils.default.getWhatYear(d,4)),this.dateMoveYear(d)}else{var h=a||_xeUtils.default.getWhatDay(Date.now(),0,"first");s?h=_xeUtils.default.getWhatDay(h,-1):l?h=_xeUtils.default.getWhatWeek(h,-1):r?h=_xeUtils.default.getWhatDay(h,1):u&&(h=_xeUtils.default.getWhatWeek(h,1)),this.dateMoveDay(h)}},dateChangeValue:function(e){var t=this.value,a=this.type,n=this.dateValueFormat,i=this.dateOpts;"week"===a&&(e=_xeUtils.default.getWhatWeek(e,0,i.startWeek));var s=_xeUtils.default.toDateString(e,n);this.dateCheckMonth(e),_xeUtils.default.isEqual(t,s)||this.emitUpdate(s)},dateCheckMonth:function(e){var t=_xeUtils.default.getWhatMonth(e,0,"first");_xeUtils.default.isEqual(t,this.selectMonth)||(this.selectMonth=t)},dateOpenPanel:function(){var e=this.type,t=this.dateValue;-1<["year","month","week"].indexOf(e)?this.datePanelType=e:this.datePanelType="day",this.currentDate=_xeUtils.default.getWhatDay(Date.now(),0,"first"),t?(this.dateMonthHandle(t,0),this.dateParseValue(t)):this.dateNowHandle()},dateRevertValue:function(){this.inputValue=this.datePanelLabel},updateZindex:function(){this.panelIndex<_tools.UtilTools.getLastZIndex()&&(this.panelIndex=_tools.UtilTools.nextZIndex())},showPanel:function(){var e=this,t=this.disabled,a=this.visiblePanel,n=this.isDatePicker;t||a||(clearTimeout(this.hidePanelTimeout),this.isActivated=!0,this.animatVisible=!0,n&&this.dateOpenPanel(),setTimeout(function(){e.visiblePanel=!0},10),this.updateZindex(),this.updatePlacement())},hidePanel:function(){var e=this;this.visiblePanel=!1,this.hidePanelTimeout=setTimeout(function(){e.animatVisible=!1},250)},updatePlacement:function(){var x=this;this.$nextTick(function(){var e=x.$refs,t=x.transfer,a=x.placement,n=x.panelIndex,i=e.input,s=e.panel,l=i.offsetHeight,r=i.offsetWidth,u=s.offsetHeight,o={zIndex:n},d=_tools.DomTools.getAbsolutePos(i),h=d.boundingTop,c=d.boundingLeft,f=d.visibleHeight,p="bottom";if(t){var v=c,m=h+l;"top"===a?(p="top",m=h-u):(f<m+u&&(p="top",m=h-u),m<0&&(p="bottom",m=h+l)),Object.assign(o,{left:"".concat(v,"px"),top:"".concat(m,"px"),minWidth:"".concat(r,"px")})}else"top"===a?(p="top",o.bottom="".concat(l,"px")):f<h+l+u&&(p="top",o.bottom="".concat(l,"px"));x.panelStyle=o,x.panelPlacement=p})},handleGlobalMousedownEvent:function(e){var t=this.$refs,a=this.$el,n=this.disabled,i=this.visiblePanel,s=this.isActivated;!n&&s&&(this.isActivated=_tools.DomTools.getEventTargetNode(e,a).flag||_tools.DomTools.getEventTargetNode(e,t.panel).flag,this.isActivated||(i&&this.hidePanel(),this.afterCheckValue()))},handleGlobalKeydownEvent:function(e){var t=this.isDatePicker,a=this.visiblePanel,n=this.clearable;if(!this.disabled){var i=e.keyCode,s=9===i,l=46===i,r=27===i,u=13===i,o=37===i||38===i||39===i||40===i,d=this.isActivated;s?(d=!1,this.isActivated&&this.afterCheckValue(),this.isActivated=d):o&&t&&this.dateOffsetEvent(e),u?t&&(a?this.dateSelectItem(this.datePanelValue):d&&this.showPanel()):(s||r)&&a&&this.hidePanel(),l&&n&&d&&this.clearValueEvent(e,null)}},handleGlobalMousewheelEvent:function(e){var t=this.$refs,a=this.$el,n=this.visiblePanel;_tools.DomTools.getEventTargetNode(e,a).flag||_tools.DomTools.getEventTargetNode(e,t.panel).flag||(n&&this.hidePanel(),this.afterCheckValue())},handleGlobalBlurEvent:function(){this.visiblePanel&&this.hidePanel(),this.afterCheckValue()}}};exports.default=_default2;